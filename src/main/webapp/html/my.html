<!DOCTYPE html>
<html lang="en">
<head>
    <title>RPG</title>
    <script src=https://code.jquery.com/jquery-3.6.0.min.js></script>
    <link href="/css/custom.css" rel="stylesheet">
    <style>
        .unselected-button {
            font-weight: normal;
            color: black;
        }

        .selected-button {
            font-weight: bold;
            color: red;
        }
    </style>
</head>
<body>
<h1>RPG admin panel</h1>
<h2>Accounts list:</h2>
<div>
    <label for="count-per-page-selector">Count per page:</label>
    <select id="count-per-page-selector"
            onchange="count_per_page = this.value; renderTable(last_visited_page, this.value); pages=get_pages(); generateButtons(document.getElementById('pages'))">
        <option typeof="numeric" value=3 selected="selected">3</option>
        <option typeof="numeric" value=5>5</option>
        <option typeof="numeric" value=10>10</option>
        <option typeof="numeric" value=20>20</option>
    </select>
</div>
<table id="admin-table">
    <thead>
    <tr>
        <th>#</th>
        <th>Name</th>
        <th>Title</th>
        <th>Race</th>
        <th>Profession</th>
        <th>Level</th>
        <th>Birthday</th>
        <th>Banned</th>
    </tr>
    </thead>
</table>
<div id="pages">Pages:</div>
<script>
    const players_count = get_players_count()
    let count_per_page = get_count_per_page()
    let pages = get_pages()
    let last_visited_page = 0

    function get_players_count() {
        let players_count
        $.ajax({
            type: "GET",
            url: "/rest/players/count",
            success: function (data) {
                players_count = data
            },
            async: false
        });
        return players_count
    }

    function get_count_per_page() {
        return parseInt(document.getElementById("count-per-page-selector").value);
    }

    function get_pages() {
        return Math.ceil(players_count / count_per_page)
    }

    function removeExtraPageContent() {
        const table = document.getElementById("admin-table");
        let elementsByTagName = table.getElementsByTagName("tbody");
        if (elementsByTagName.length > 0) {
            table.removeChild(elementsByTagName[0]);
        }
    }

    function markCurrentPageButton(page_number) {
        document.getElementById("button-" + last_visited_page).classList.remove('selected-button')
        document.getElementById("button-" + page_number).classList.add('selected-button')
        last_visited_page = page_number
    }

    function putDataToTable(page_number, page_size) {
        $.getJSON('/rest/players', {pageNumber: page_number, pageSize: page_size}, function (data) {
            const tbody = document.createElement("tbody");
            let odd = false;
            $.each(data, function () {
                const tr = tbody.insertRow();
                tr.className = odd ? "odd" : "even";
                $.each(this, function (k, v) {
                    const cell = tr.insertCell();
                    cell.appendChild(document.createTextNode(v.toString()));
                });
                odd = !odd;
            });
            $("#admin-table").append(tbody);
        });
    }

    function renderTable(page_number, page_size) {
        removeExtraPageContent();
        markCurrentPageButton(page_number);
        putDataToTable(page_number, page_size);
    }

    $(function () {
        generateButtons(document.getElementById('pages'))
        renderTable(0);
    });

    function generateButtons(context) {
        const div = document.getElementById("pages");
        div.innerHTML = 'Pages:';
        for (let i = 0; i < pages; i++) {
            const button = document.createElement("input");
            button.id = "button-" + i;
            button.type = "button";
            button.value = i + '';
            button.onclick = function () {
                renderTable(i, count_per_page)
            }
            context.appendChild(button);
        }
    }
</script>
</body>
</html>